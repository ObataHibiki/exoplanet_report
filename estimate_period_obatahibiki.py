import numpy as np
import matplotlib.pyplot as plt
from scipy.signal import lombscargle
from scipy.interpolate import interp1d

# === データを直接記入 ===
raw_data = [
    [14.75943013143777449, 10.29276526418392912],
    [51.85632248445747194, -3.249059287763180759],
    [63.60438878212471536, -1.700108753335274336],
    [86.34033088432124714, -6.955230249810869125],
    [104.6478998086038672, -5.988878466163186864],
    [279.9123087428177428, 0.4491811842698901769],
    [302.7032161930821985, 5.343830234167499249],
    [309.2680035174004161, 6.473086308887705087],
    [319.4386642217655208, 7.339880010333093452],
    [336.8799344446402415, 12.37654249070353174],
    [380.9492748775522841, 7.930107959072777213],
    [386.0932914196202432, 4.327858815767007705],
    [397.7647235877346930, 1.437625811081091776],
    [400.6338578669470394, 1.084282895994354012],
    [414.6725295985705770, -0.9271728835113239864],
    [440.0172645322999756, -3.695967346343064897],
    [467.1423455690924129, -6.373664267627315638],
    [471.5027025386589230, -6.368450716381578225],
    [522.0882374518662346, -6.976346898853369893],
    [568.0544281933908906, -6.050366999996878548],
    [569.7862986891125274, -6.267611406635054117],
    [577.9592778003451485, -2.262851651405441089],
    [583.3857518782082252, -4.471246878319825591],
    [607.8124872499947742, -3.020041449722365989],
    [635.1088682201780102, -1.646300434931433854],
    [650.9942905709182241, 2.140575039752232289],
    [675.6855459536425315, 3.668134396731464797],
    [689.6083094461962446, 8.258289731291169389],
    [703.4738151657512617, 11.59576134374126077],
    [714.3913898299176708, 16.05189275361949797],
]

# 時間と視線速度に分割
data = np.array(raw_data)
t = data[:, 0]  # 時間 [day]
v = data[:, 1]  # 視線速度 [cm/s]

# トレンド除去（平均を引く）
v_detrended = v - np.mean(v)

# 周波数範囲（周期1000日〜1日）
min_freq = 1 / 1000
max_freq = 1 / 1
num_freqs = 10000
freqs = np.linspace(min_freq, max_freq, num_freqs)
angular_freqs = 2 * np.pi * freqs

# Lomb-Scargle パワースペクトル計算
pgram = lombscargle(t, v_detrended, angular_freqs)
pgram /= pgram.max()  # 正規化

# 最大パワーの周波数・周期を取得
best_freq = freqs[np.argmax(pgram)]
best_period = 1 / best_freq
print(f"▶ 推定される主周期: {best_period:.2f} 日（周波数: {best_freq:.5f} 1/day）")


# プロット
plt.figure(figsize=(12, 6))

# 視線速度の時系列
plt.subplot(2, 1, 1)
plt.plot(t, v, 'o-', color='blue')
plt.xlabel("time (day)")
plt.ylabel("radial velocity (cm/s)")
plt.title("data set of radial velocity")

# Lomb-Scargle パワースペクトル（周期表示）
plt.subplot(2, 1, 2)
plt.plot(1 / freqs, pgram, color='red')
plt.xlabel("period (day)")
plt.ylabel("power")
plt.title("Lomb-Scargle power spectrum")
plt.axvline(best_period, color='gray', linestyle='--', label=f"period ≈ {best_period:.2f} ± {period_std:.2f} day")
plt.legend()
plt.gca().invert_xaxis()  # 周期を大→小に

plt.tight_layout()
plt.show()
